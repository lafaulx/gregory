!function(e,a){"use strict";!function(e,a){!function(e,a){var t=[31,28,31,30,31,30,31,31,30,31,30,31],r="MON",n={year:"",months:{0:{s:"Jan",f:"January"},1:{s:"Feb",f:"February"},2:{s:"Mar",f:"March"},3:{s:"Apr",f:"April"},4:{s:"May",f:"May"},5:{s:"Jun",f:"June"},6:{s:"Jul",f:"July"},7:{s:"Aug",f:"August"},8:{s:"Sep",f:"September"},9:{s:"Oct",f:"October"},10:{s:"Nov",f:"November"},11:{s:"Dec",f:"December"}}},s=function(a){var t=this;t.$b=e("<div class='gregory'></div>"),t.$calendarWrapper,t.$dateInfo,t.$changeBack,t.$changeForward,t.modes={day:"day",month:"month",year:"year"},t.displayState={},t.selectedState={},t.prevFullState={},t.weekStartDay=a.weekStartDay||r,t.onDateSelect=a.onDateSelect,t.messages=a.messages||n,t.viewReverse=a.viewReverse,t.generateDOM(),t.prevFullState.mode=t.modes.day,t.$b.on("mousedown.gregory",function(e){e.stopPropagation()}),t.$b.on("click.gregory","a.change",function(a){a.preventDefault();var r=(e(this),this.hash.split("/")),n=parseInt(r[0].substring(2),10),s=parseInt(r[1],10),d=(parseInt(r[2],10),{});d.year=n,(0===s||s)&&(d.month=s),t.changeDisplayState(d,"dateChange")}),t.$calendarWrapper.on("click.gregory","a",function(a){a.preventDefault();var r=e(this),n=this.hash.split("/"),s=parseInt(n[0].substring(2),10),d=parseInt(n[1],10),o=parseInt(n[2],10);t.changeSelectedState({year:s,month:d,day:o},r),t.onDateSelect&&t.onDateSelect(t.selectedState)}),t.$dateInfo.on("click.gregory",function(e){e.preventDefault();var a={};a.mode=this.hash.split("!")[1],a.mode===t.modes.day?t.changeSelectedState(t.prevFullState):(a.month=null===t.displayState.month?t.selectedState.month:t.displayState.month,t.isYearActive(t.displayState.year)||t.displayState.mode!==t.modes.month||(a.year=t.selectedState.year),t.changeDisplayState(a))})};s.prototype={init:function(e){var a=this;e.date&&(e.year=e.date.getFullYear(),e.month=e.date.getMonth(),e.day=e.date.getDate()),e.mode=e.day?a.modes.day:a.modes.month,a.changeDisplayState(e),a.changeSelectedState(e)},changeDisplayState:function(e){var a=this;a.setDisplayState(e),a.generateCalendar(),a.updateInfo()},changeSelectedState:function(e,a){var t=this;if(t.displayState.mode===t.modes.day){if(t.$calendarWrapper.find(".active").removeClass("active"),!a){var r="a[href='#!"+e.year+(0===e.month||e.month?"/"+e.month+(e.day?"/"+e.day:""):"")+"']";a=t.$calendarWrapper.find(r)}a.addClass("active")}t.setSelectedState(e),t.updatePrevFullState(),e.mode||(t.displayState.mode===t.modes.year?e.mode=t.modes.month:t.displayState.mode===t.modes.month&&(e.mode=t.modes.day)),t.changeDisplayState(e)},generateDOM:function(){var a=this,t=e("<div class='date-info'><a href='#!'></a></div>");a.$b.addClass(a.viewReverse?"reverse":"endian"),a.$calendarWrapper=e("<div class='wrapper'></div>"),a.$dateInfo=t.find("a"),a.$changeBack=e("<a class='change back gregory-icon-left' href='#!'></a>"),a.$changeForward=e("<a class='change forward gregory-icon-right' href='#!'></a>"),a.$b.append(a.$calendarWrapper),a.$b.prepend(t),a.$b.prepend(a.$changeBack),a.$b.prepend(a.$changeForward),a.viewReverse?(a.$b.prepend(a.$calendarWrapper),a.$b.append(t),a.$b.append(a.$changeBack),a.$b.append(a.$changeForward)):(a.$b.append(a.$calendarWrapper),a.$b.prepend(t),a.$b.prepend(a.$changeBack),a.$b.prepend(a.$changeForward))},generateCalendar:function(){var e=this;e.displayState.mode===e.modes.day?e.generateDayCalendar():e.displayState.mode===e.modes.month?e.generateMonthCalendar():e.generateYearCalendar()},generateDayCalendar:function(){var e=this,a=new Date(e.displayState.year,e.displayState.month,1).getDay(),t=e.getDaysInMonth(e.displayState.year,e.displayState.month),r="MON"===e.weekStartDay?0===a?6:a-1:a,n='<ul class="day">',s=1,d=e.decrementMonth(e.displayState.year,e.displayState.month),o=e.incrementMonth(e.displayState.year,e.displayState.month);e.setChange(d.year+"/"+d.month,o.year+"/"+o.month);for(var l=0;9>l;l++){for(var i=0;6>=i;i++)if(t>=s&&(i>=r&&0===l||l>0))n+="<li><a class='"+(e.isDayActive(s)?"active":"")+"' href='#!"+e.displayState.year+"/"+e.displayState.month+"/"+s+"'>"+s+"</a></li>",s++;else{if(s>t)break;n+="<li></li>"}if(s>t)break}n+="</ul>",e.$calendarWrapper.html(n)},generateMonthCalendar:function(){var e=this,a='<ul class="month">',t=0;e.setChange(e.displayState.year-1,e.displayState.year+1);for(var r=0;4>r;r++){for(var n=0;2>=n;n++)a+="<li><a class='"+(e.isMonthActive(t)?"active'":"")+"' href='#!"+e.displayState.year+"/"+t+"'>"+e.messages.months[t].s+"</a></li>",t++;if(t>11)break}a+="</ul>",e.$calendarWrapper.html(a)},generateYearCalendar:function(){var e=this,a='<ul class="year">',t=e.displayState.twelfth-11;e.setChange(t-1,e.displayState.twelfth+12);for(var r=0;4>r;r++){for(var n=0;2>=n;n++)a+="<li><a class='"+(e.isYearActive(t)?"active'":"")+"' href='#!"+t+"'>"+t+"</a></li>",t++;if(t>e.displayState.twelfth)break}a+="</ul>",e.$calendarWrapper.html(a)},setChange:function(e,a){var t=this;t.$changeBack.attr("href","#!"+e),t.$changeForward.attr("href","#!"+a)},setDateActive:function(){var e=this;e.$calendarWrapper.find("a[href='#!"+e.formUrl+"']").addClass("active")},decrementMonth:function(e,a){var t={};return 0===a?(t.year=e-1,t.month=11):(t.year=e,t.month=a-1),t},incrementMonth:function(e,a){var t={};return 11===a?(t.year=e+1,t.month=0):(t.year=e,t.month=a+1),t},getDaysInMonth:function(){var e=this;return 1===e.displayState.month&&(e.displayState.year%4===0&&e.displayState.year%100!==0||e.displayState.year%400===0)?29:t[e.displayState.month]},updateInfo:function(){var e,a=this;a.$dateInfo.html(a.displayState.mode===a.modes.day?a.messages.months[a.displayState.month].f+", "+a.displayState.year:a.displayState.mode===a.modes.month?a.displayState.year+" "+a.messages.year:a.prevFullState.day+"."+(a.prevFullState.month+1)+"."+a.prevFullState.year),a.displayState.mode===a.modes.day?e=a.modes.month:a.displayState.mode===a.modes.month?e=a.modes.year:a.displayState.mode===a.modes.year&&(e=a.modes.day),a.$dateInfo.attr("href","#!"+e)},setDisplayState:function(e){var a=this;e.year&&(a.displayState.year=e.year,a.displayState.twelfth=e.year),a.displayState.month=0===e.month||e.month?e.month:null,e.mode&&(a.displayState.mode=e.mode),a.displayState.mode||(a.displayState.mode=0===e.month||e.month?a.modes.day:a.modes.month)},setSelectedState:function(e){var a=this;a.selectedState.year=e.year,a.selectedState.month=e.month,a.selectedState.day=e.day?e.day:null},updatePrevFullState:function(){var e=this;e.selectedState.day&&(e.selectedState.month||0===e.selectedState.month)&&e.selectedState.year&&(e.prevFullState.day=e.selectedState.day,e.prevFullState.month=e.selectedState.month,e.prevFullState.year=e.selectedState.year)},isDayActive:function(e){var a=this;return e===a.selectedState.day&&a.displayState.month===a.selectedState.month&&a.displayState.year===a.selectedState.year},isMonthActive:function(e){var a=this;return e===a.selectedState.month&&a.displayState.year===a.selectedState.year},isYearActive:function(e){var a=this;return e===a.selectedState.year},remove:function(){var e=this;e.$b.off(".gregory"),e.$b.remove()}},a.Gregory=s}(jQuery,e,a)}(e,a)}(window,document);