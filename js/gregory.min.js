!function(e,t){var a=[31,28,31,30,31,30,31,31,30,31,30,31],r="MON",n={year:"",months:{0:{s:"Jan",f:"January"},1:{s:"Feb",f:"February"},2:{s:"Mar",f:"March"},3:{s:"Apr",f:"April"},4:{s:"May",f:"May"},5:{s:"Jun",f:"June"},6:{s:"Jul",f:"July"},7:{s:"Aug",f:"August"},8:{s:"Sep",f:"September"},9:{s:"Oct",f:"October"},10:{s:"Nov",f:"November"},11:{s:"Dec",f:"December"}}},o=function(t){var a=this;a.$b=e("<div class='gregory'></div>"),a.$calendarWrapper,a.$dateInfo,a.$changeBack,a.$changeForward,a.modes={day:"day",month:"month",year:"year"},a.displayState={},a.selectedState={},a.prevFullState={},a.weekStartDay=t.weekStartDay||r,a.onDateSelect=t.onDateSelect,a.messages=t.messages||n,a.generateDOM(),a.prevFullState.mode=a.modes.day,a.$b.on("mousedown.gregory",function(e){e.stopPropagation()}),a.$b.on("click.gregory","a.change",function(t){t.preventDefault();var r=(e(this),this.hash.split("/")),n=parseInt(r[0].substring(2),10),o=parseInt(r[1],10),s=(parseInt(r[2],10),{});s.year=n,(0===o||o)&&(s.month=o),a.changeDisplayState(s,"dateChange")}),a.$calendarWrapper.on("click.gregory","a",function(t){t.preventDefault();var r=e(this),n=this.hash.split("/"),o=parseInt(n[0].substring(2),10),s=parseInt(n[1],10),d=parseInt(n[2],10);a.changeSelectedState({year:o,month:s,day:d},r),a.onDateSelect&&a.onDateSelect(a.selectedState)}),a.$dateInfo.on("click.gregory",function(e){e.preventDefault();var t={};t.mode=this.hash.split("!")[1],t.mode===a.modes.day?a.changeSelectedState(a.prevFullState):(t.month=null===a.displayState.month?a.selectedState.month:a.displayState.month,a.isYearActive(a.displayState.year)||a.displayState.mode!==a.modes.month||(t.year=a.selectedState.year),a.changeDisplayState(t))})};o.prototype.init=function(e){var t=this;e.date&&(e.year=e.date.getFullYear(),e.month=e.date.getMonth(),e.day=e.date.getDate()),e.mode=e.day?t.modes.day:t.modes.month,t.changeDisplayState(e),t.changeSelectedState(e)},o.prototype.changeDisplayState=function(e){var t=this;t.setDisplayState(e),t.generateCalendar(),t.updateInfo()},o.prototype.changeSelectedState=function(e,t){var a=this;if(a.displayState.mode===a.modes.day){if(a.$calendarWrapper.find(".active").removeClass("active"),!t){var r="a[href='#!"+e.year+(0===e.month||e.month?"/"+e.month+(e.day?"/"+e.day:""):"")+"']";t=a.$calendarWrapper.find(r)}t.addClass("active")}a.setSelectedState(e),a.updatePrevFullState(),e.mode||(a.displayState.mode===a.modes.year?e.mode=a.modes.month:a.displayState.mode===a.modes.month&&(e.mode=a.modes.day)),a.changeDisplayState(e)},o.prototype.generateDOM=function(){var t=this,a=e("<div class='date-info'><a href='#!'></a></div>");t.$calendarWrapper=e("<div class='wrapper'></div>"),t.$dateInfo=a.find("a"),t.$changeBack=e("<a class='change back gregory-icon-left' href='#!'></a>"),t.$changeForward=e("<a class='change forward gregory-icon-right' href='#!'></a>"),t.$b.append(t.$calendarWrapper),t.$b.prepend(a),t.$b.prepend(t.$changeBack),t.$b.prepend(t.$changeForward)},o.prototype.generateCalendar=function(){var e=this;e.displayState.mode===e.modes.day?e.generateDayCalendar():e.displayState.mode===e.modes.month?e.generateMonthCalendar():e.generateYearCalendar()},o.prototype.generateDayCalendar=function(){var e=this,t=new Date(e.displayState.year,e.displayState.month,1).getDay(),a=e.getDaysInMonth(e.displayState.year,e.displayState.month),r="MON"===e.weekStartDay?0===t?6:t-1:t,n='<ul class="day">',o=1,s=e.decrementMonth(e.displayState.year,e.displayState.month),d=e.incrementMonth(e.displayState.year,e.displayState.month);e.setChange(s.year+"/"+s.month,d.year+"/"+d.month);for(var l=0;9>l;l++){for(var y=0;6>=y;y++)if(a>=o&&(y>=r&&0===l||l>0))n+="<li><a class='"+(e.isDayActive(o)?"active":"")+"' href='#!"+e.displayState.year+"/"+e.displayState.month+"/"+o+"'>"+o+"</a></li>",o++;else{if(o>a)break;n+="<li></li>"}if(o>a)break}n+="</ul>",e.$calendarWrapper.html(n)},o.prototype.generateMonthCalendar=function(){var e=this,t='<ul class="month">',a=0;e.setChange(e.displayState.year-1,e.displayState.year+1);for(var r=0;4>r;r++){for(var n=0;2>=n;n++)t+="<li><a class='"+(e.isMonthActive(a)?"active'":"")+"' href='#!"+e.displayState.year+"/"+a+"'>"+e.messages.months[a].s+"</a></li>",a++;if(a>11)break}t+="</ul>",e.$calendarWrapper.html(t)},o.prototype.generateYearCalendar=function(){var e=this,t='<ul class="year">',a=e.displayState.twelfth-11;e.setChange(a-1,e.displayState.twelfth+12);for(var r=0;4>r;r++){for(var n=0;2>=n;n++)t+="<li><a class='"+(e.isYearActive(a)?"active'":"")+"' href='#!"+a+"'>"+a+"</a></li>",a++;if(a>e.displayState.twelfth)break}t+="</ul>",e.$calendarWrapper.html(t)},o.prototype.setChange=function(e,t){var a=this;a.$changeBack.attr("href","#!"+e),a.$changeForward.attr("href","#!"+t)},o.prototype.setDateActive=function(){var e=this;e.$calendarWrapper.find("a[href='#!"+e.formUrl+"']").addClass("active")},o.prototype.decrementMonth=function(e,t){var a={};return 0===t?(a.year=e-1,a.month=11):(a.year=e,a.month=t-1),a},o.prototype.incrementMonth=function(e,t){var a={};return 11===t?(a.year=e+1,a.month=0):(a.year=e,a.month=t+1),a},o.prototype.getDaysInMonth=function(){var e=this;return 1===e.displayState.month&&(e.displayState.year%4===0&&e.displayState.year%100!==0||e.displayState.year%400===0)?29:a[e.displayState.month]},o.prototype.updateInfo=function(){var e,t=this;t.displayState.mode===t.modes.day?t.$dateInfo.html(t.messages.months[t.displayState.month].f+", "+t.displayState.year):t.displayState.mode===t.modes.month?t.$dateInfo.html(t.displayState.year+" "+t.messages.year):t.$dateInfo.html(t.prevFullState.day+"."+(t.prevFullState.month+1)+"."+t.prevFullState.year),t.displayState.mode===t.modes.day?e=t.modes.month:t.displayState.mode===t.modes.month?e=t.modes.year:t.displayState.mode===t.modes.year&&(e=t.modes.day),t.$dateInfo.attr("href","#!"+e)},o.prototype.setDisplayState=function(e){var t=this;e.year&&(t.displayState.year=e.year,t.displayState.twelfth=e.year),t.displayState.month=0===e.month||e.month?e.month:null,e.mode&&(t.displayState.mode=e.mode),t.displayState.mode||(t.displayState.mode=0===e.month||e.month?t.modes.day:t.modes.month)},o.prototype.setSelectedState=function(e){var t=this;t.selectedState.year=e.year,t.selectedState.month=e.month,t.selectedState.day=e.day?e.day:null},o.prototype.updatePrevFullState=function(){var e=this;e.selectedState.day&&(e.selectedState.month||0===e.selectedState.month)&&e.selectedState.year&&(e.prevFullState.day=e.selectedState.day,e.prevFullState.month=e.selectedState.month,e.prevFullState.year=e.selectedState.year)},o.prototype.isDayActive=function(e){var t=this;return e===t.selectedState.day&&t.displayState.month===t.selectedState.month&&t.displayState.year===t.selectedState.year},o.prototype.isMonthActive=function(e){var t=this;return e===t.selectedState.month&&t.displayState.year===t.selectedState.year},o.prototype.isYearActive=function(e){var t=this;return e===t.selectedState.year},o.prototype.remove=function(){var e=this;e.$b.off(".gregory"),e.$b.remove()},t.Gregory=o}(jQuery,window,document);